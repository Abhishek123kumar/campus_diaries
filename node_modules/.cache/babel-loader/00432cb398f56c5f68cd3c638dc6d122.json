{"ast":null,"code":"import _toConsumableArray from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/regenerator/index.js\";import{collection,deleteDoc,doc,getDocs,limit,onSnapshot,query,orderBy,where,startAfter}from\"firebase/firestore\";import React,{useState,useEffect}from\"react\";import BlogSection from\"../components/BlogSection\";import Spinner from\"../components/Spinner\";import{db}from\"../firebase\";import{toast}from\"react-toastify\";import Tags from\"../components/Tags\";import FeatureBlogs from\"../components/FeatureBlogs\";import Trending from\"../components/Trending\";import Search from\"../components/Search\";import{isEmpty,isNull}from\"lodash\";import{useLocation}from\"react-router-dom\";import Category from\"../components/Category\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";function useQuery(){return new URLSearchParams(useLocation().search);}var Home=function Home(_ref){var setActive=_ref.setActive,user=_ref.user,active=_ref.active;var _useState=useState(true),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),blogs=_useState4[0],setBlogs=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),tags=_useState6[0],setTags=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),search=_useState8[0],setSearch=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),lastVisible=_useState10[0],setLastVisible=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),trendBlogs=_useState12[0],setTrendBlogs=_useState12[1];var _useState13=useState(null),_useState14=_slicedToArray(_useState13,2),totalBlogs=_useState14[0],setTotalBlogs=_useState14[1];var _useState15=useState(false),_useState16=_slicedToArray(_useState15,2),hide=_useState16[0],setHide=_useState16[1];var queryString=useQuery();var searchQuery=queryString.get(\"searchQuery\");var location=useLocation();var getTrendingBlogs=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var blogRef,trendQuery,querySnapshot,trendBlogs;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:blogRef=collection(db,\"blogs\");trendQuery=query(blogRef,where(\"trending\",\"==\",\"yes\"));_context.next=4;return getDocs(trendQuery);case 4:querySnapshot=_context.sent;trendBlogs=[];querySnapshot.forEach(function(doc){trendBlogs.push(_objectSpread({id:doc.id},doc.data()));});setTrendBlogs(trendBlogs);case 8:case\"end\":return _context.stop();}}},_callee);}));return function getTrendingBlogs(){return _ref2.apply(this,arguments);};}();useEffect(function(){getTrendingBlogs();setSearch(\"\");var unsub=onSnapshot(collection(db,\"blogs\"),function(snapshot){var list=[];var tags=[];snapshot.docs.forEach(function(doc){tags.push.apply(tags,_toConsumableArray(doc.get(\"tags\")));list.push(_objectSpread({id:doc.id},doc.data()));});var uniqueTags=_toConsumableArray(new Set(tags));setTags(uniqueTags);setTotalBlogs(list);// setBlogs(list);\nsetLoading(false);setActive(\"home\");},function(error){console.log(error);});return function(){unsub();getTrendingBlogs();};},[setActive,active]);useEffect(function(){getBlogs();setHide(false);},[active]);var getBlogs=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var blogRef,firstFour,docSnapshot;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:blogRef=collection(db,\"blogs\");console.log(blogRef);firstFour=query(blogRef,orderBy(\"title\"),limit(4));_context2.next=5;return getDocs(firstFour);case 5:docSnapshot=_context2.sent;setBlogs(docSnapshot.docs.map(function(doc){return _objectSpread({id:doc.id},doc.data());}));setLastVisible(docSnapshot.docs[docSnapshot.docs.length-1]);case 8:case\"end\":return _context2.stop();}}},_callee2);}));return function getBlogs(){return _ref3.apply(this,arguments);};}();console.log(\"blogs\",blogs);var updateState=function updateState(docSnapshot){var isCollectionEmpty=docSnapshot.size===0;if(!isCollectionEmpty){var blogsData=docSnapshot.docs.map(function(doc){return _objectSpread({id:doc.id},doc.data());});setBlogs(function(blogs){return[].concat(_toConsumableArray(blogs),_toConsumableArray(blogsData));});setLastVisible(docSnapshot.docs[docSnapshot.docs.length-1]);}else{toast.info(\"No more blog to display\");setHide(true);}};var fetchMore=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var blogRef,nextFour,docSnapshot;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setLoading(true);blogRef=collection(db,\"blogs\");nextFour=query(blogRef,orderBy(\"title\"),limit(4),startAfter(lastVisible));_context3.next=5;return getDocs(nextFour);case 5:docSnapshot=_context3.sent;updateState(docSnapshot);setLoading(false);case 8:case\"end\":return _context3.stop();}}},_callee3);}));return function fetchMore(){return _ref4.apply(this,arguments);};}();var searchBlogs=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var blogRef,searchTitleQuery,searchTagQuery,titleSnapshot,tagSnapshot,searchTitleBlogs,searchTagBlogs,combinedSearchBlogs;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:blogRef=collection(db,\"blogs\");searchTitleQuery=query(blogRef,where(\"title\",\"==\",searchQuery));searchTagQuery=query(blogRef,where(\"tags\",\"array-contains\",searchQuery));_context4.next=5;return getDocs(searchTitleQuery);case 5:titleSnapshot=_context4.sent;_context4.next=8;return getDocs(searchTagQuery);case 8:tagSnapshot=_context4.sent;searchTitleBlogs=[];searchTagBlogs=[];titleSnapshot.forEach(function(doc){searchTitleBlogs.push(_objectSpread({id:doc.id},doc.data()));});tagSnapshot.forEach(function(doc){searchTagBlogs.push(_objectSpread({id:doc.id},doc.data()));});combinedSearchBlogs=searchTitleBlogs.concat(searchTagBlogs);setBlogs(combinedSearchBlogs);setHide(true);setActive(\"\");case 17:case\"end\":return _context4.stop();}}},_callee4);}));return function searchBlogs(){return _ref5.apply(this,arguments);};}();useEffect(function(){if(!isNull(searchQuery)){searchBlogs();}},[searchQuery]);if(loading){return/*#__PURE__*/_jsx(Spinner,{});}var handleDelete=/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(id){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:if(!window.confirm(\"Are you sure wanted to delete that blog ?\")){_context5.next=12;break;}_context5.prev=1;setLoading(true);_context5.next=5;return deleteDoc(doc(db,\"blogs\",id));case 5:toast.success(\"Blog deleted successfully\");setLoading(false);_context5.next=12;break;case 9:_context5.prev=9;_context5.t0=_context5[\"catch\"](1);console.log(_context5.t0);case 12:case\"end\":return _context5.stop();}}},_callee5,null,[[1,9]]);}));return function handleDelete(_x){return _ref6.apply(this,arguments);};}();var handleChange=function handleChange(e){var value=e.target.value;if(isEmpty(value)){console.log(\"test\");getBlogs();setHide(false);}setSearch(value);};// category count\nvar counts=totalBlogs.reduce(function(prevValue,currentValue){var name=currentValue.category;if(!prevValue.hasOwnProperty(name)){prevValue[name]=0;}prevValue[name]++;// delete prevValue[\"undefined\"];\nreturn prevValue;},{});var categoryCount=Object.keys(counts).map(function(k){return{category:k,count:counts[k]};});console.log(\"categoryCount\",categoryCount);return/*#__PURE__*/_jsx(\"div\",{className:\"container-fluid pb-4 pt-4 padding\",children:/*#__PURE__*/_jsx(\"div\",{className:\"container padding\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"row mx-0\",children:[/*#__PURE__*/_jsx(Trending,{blogs:trendBlogs}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"blog-heading text-start py-2 mb-4\",children:\"Daily Blogs\"}),blogs.length===0&&location.pathname!==\"/\"&&/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"h4\",{children:[\"No Blog found with search keyword:\",\" \",/*#__PURE__*/_jsx(\"strong\",{children:searchQuery})]})}),blogs===null||blogs===void 0?void 0:blogs.map(function(blog){return/*#__PURE__*/_jsx(BlogSection,_objectSpread({user:user,handleDelete:handleDelete},blog),blog.id);}),!hide&&/*#__PURE__*/_jsx(\"button\",{className:\"btn btn-primary\",onClick:fetchMore,children:\"Load More\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(Search,{search:search,handleChange:handleChange}),/*#__PURE__*/_jsx(\"div\",{className:\"blog-heading text-start py-2 mb-4\",children:\"Tags\"}),/*#__PURE__*/_jsx(Tags,{tags:tags}),/*#__PURE__*/_jsx(FeatureBlogs,{title:\"Most Popular\",blogs:blogs}),/*#__PURE__*/_jsx(Category,{catgBlogsCount:categoryCount})]})]})})});};export default Home;","map":null,"metadata":{},"sourceType":"module"}