{"ast":null,"code":"import _objectSpread from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/regenerator/index.js\";import{collection,endAt,endBefore,getDocs,limit,limitToLast,orderBy,query,startAfter}from\"firebase/firestore\";import React from\"react\";import{useEffect}from\"react\";import{useState}from\"react\";import BlogSection from\"../components/BlogSection\";import Pagination from\"../components/Pagination\";import Spinner from\"../components/Spinner\";import{db}from\"../firebase\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Blogs=function Blogs(_ref){var setActive=_ref.setActive;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState([]),_useState4=_slicedToArray(_useState3,2),blogs=_useState4[0],setBlogs=_useState4[1];var _useState5=useState(1),_useState6=_slicedToArray(_useState5,2),currentPage=_useState6[0],setCurrentPage=_useState6[1];var _useState7=useState(null),_useState8=_slicedToArray(_useState7,2),lastVisible=_useState8[0],setLastVisible=_useState8[1];var _useState9=useState(null),_useState10=_slicedToArray(_useState9,2),noOfPages=_useState10[0],setNoOfPages=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),count=_useState12[0],setCount=_useState12[1];useEffect(function(){getBlogsData();getTotalBlogs();setActive(\"blogs\");},[]);if(loading){return/*#__PURE__*/_jsx(Spinner,{});}var getBlogsData=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var blogRef,first,docSnapshot;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);blogRef=collection(db,\"blogs\");first=query(blogRef,orderBy(\"title\"),limit(4));_context.next=5;return getDocs(first);case 5:docSnapshot=_context.sent;setBlogs(docSnapshot.docs.map(function(doc){return _objectSpread({id:doc.id},doc.data());}));setCount(docSnapshot.size);setLastVisible(docSnapshot.docs[docSnapshot.docs.length-1]);setLoading(false);case 10:case\"end\":return _context.stop();}}},_callee);}));return function getBlogsData(){return _ref2.apply(this,arguments);};}();var getTotalBlogs=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var blogRef,docSnapshot,totalBlogs,totalPage;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:blogRef=collection(db,\"blogs\");_context2.next=3;return getDocs(blogRef);case 3:docSnapshot=_context2.sent;totalBlogs=docSnapshot.size;totalPage=Math.ceil(totalBlogs/4);setNoOfPages(totalPage);case 7:case\"end\":return _context2.stop();}}},_callee2);}));return function getTotalBlogs(){return _ref3.apply(this,arguments);};}();var fetchMore=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(){var blogRef,nextBlogsQuery,nextBlogsSnaphot;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:setLoading(true);blogRef=collection(db,\"blogs\");nextBlogsQuery=query(blogRef,orderBy(\"title\"),startAfter(lastVisible),limit(4));_context3.next=5;return getDocs(nextBlogsQuery);case 5:nextBlogsSnaphot=_context3.sent;setBlogs(nextBlogsSnaphot.docs.map(function(doc){return _objectSpread({id:doc.id},doc.data());}));setCount(nextBlogsSnaphot.size);setLastVisible(nextBlogsSnaphot.docs[nextBlogsSnaphot.docs.length-1]);setLoading(false);case 10:case\"end\":return _context3.stop();}}},_callee3);}));return function fetchMore(){return _ref4.apply(this,arguments);};}();var fetchPrev=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var blogRef,end,limitData,prevBlogsQuery,prevBlogsSnaphot;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:setLoading(true);blogRef=collection(db,\"blogs\");end=noOfPages!==currentPage?endAt(lastVisible):endBefore(lastVisible);limitData=noOfPages!==currentPage?limit(4):count<=4&&noOfPages%2===0?limit(4):limitToLast(4);prevBlogsQuery=query(blogRef,orderBy(\"title\"),end,limitData);_context4.next=7;return getDocs(prevBlogsQuery);case 7:prevBlogsSnaphot=_context4.sent;setBlogs(prevBlogsSnaphot.docs.map(function(doc){return _objectSpread({id:doc.id},doc.data());}));setCount(prevBlogsSnaphot.size);setLastVisible(prevBlogsSnaphot.docs[prevBlogsSnaphot.docs.length-1]);setLoading(false);case 12:case\"end\":return _context4.stop();}}},_callee4);}));return function fetchPrev(){return _ref5.apply(this,arguments);};}();var handlePageChange=function handlePageChange(value){if(value===\"Next\"){setCurrentPage(function(page){return page+1;});fetchMore();}else if(value===\"Prev\"){setCurrentPage(function(page){return page-1;});fetchPrev();}};return/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"blog-heading text-center py-2 mb-4\",children:\"Daily Blogs\"}),blogs===null||blogs===void 0?void 0:blogs.map(function(blog){return/*#__PURE__*/_jsx(\"div\",{className:\"col-md-6\",children:/*#__PURE__*/_jsx(BlogSection,_objectSpread({},blog))},blog.id);})]}),/*#__PURE__*/_jsx(Pagination,{currentPage:currentPage,noOfPages:noOfPages,handlePageChange:handlePageChange})]})});};export default Blogs;","map":{"version":3,"names":["collection","endAt","endBefore","getDocs","limit","limitToLast","orderBy","query","startAfter","React","useEffect","useState","BlogSection","Pagination","Spinner","db","Blogs","setActive","loading","setLoading","blogs","setBlogs","currentPage","setCurrentPage","lastVisible","setLastVisible","noOfPages","setNoOfPages","count","setCount","getBlogsData","getTotalBlogs","blogRef","first","docSnapshot","docs","map","doc","id","data","size","length","totalBlogs","totalPage","Math","ceil","fetchMore","nextBlogsQuery","nextBlogsSnaphot","fetchPrev","end","limitData","prevBlogsQuery","prevBlogsSnaphot","handlePageChange","value","page","blog"],"sources":["/Users/abhishekkumar/Desktop/firebase-blog-master/src/pages/Blogs.js"],"sourcesContent":["import {\n  collection,\n  endAt,\n  endBefore,\n  getDocs,\n  limit,\n  limitToLast,\n  orderBy,\n  query,\n  startAfter,\n} from \"firebase/firestore\";\nimport React from \"react\";\nimport { useEffect } from \"react\";\nimport { useState } from \"react\";\nimport BlogSection from \"../components/BlogSection\";\nimport Pagination from \"../components/Pagination\";\nimport Spinner from \"../components/Spinner\";\nimport { db } from \"../firebase\";\n\nconst Blogs = ({setActive}) => {\n  const [loading, setLoading] = useState(false);\n  const [blogs, setBlogs] = useState([]);\n  const [currentPage, setCurrentPage] = useState(1);\n  const [lastVisible, setLastVisible] = useState(null);\n  const [noOfPages, setNoOfPages] = useState(null);\n  const [count, setCount] = useState(null);\n\n  useEffect(() => {\n    getBlogsData();\n    getTotalBlogs();\n    setActive(\"blogs\");\n  }, []);\n\n  if (loading) {\n    return <Spinner />;\n  }\n\n  const getBlogsData = async () => {\n    setLoading(true);\n    const blogRef = collection(db, \"blogs\");\n    const first = query(blogRef, orderBy(\"title\"), limit(4));\n    const docSnapshot = await getDocs(first);\n    setBlogs(docSnapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() })));\n    setCount(docSnapshot.size);\n    setLastVisible(docSnapshot.docs[docSnapshot.docs.length - 1]);\n    setLoading(false);\n  };\n\n  const getTotalBlogs = async () => {\n    const blogRef = collection(db, \"blogs\");\n    const docSnapshot = await getDocs(blogRef);\n    const totalBlogs = docSnapshot.size;\n    const totalPage = Math.ceil(totalBlogs / 4);\n    setNoOfPages(totalPage);\n  };\n\n  const fetchMore = async () => {\n    setLoading(true);\n    const blogRef = collection(db, \"blogs\");\n    const nextBlogsQuery = query(\n      blogRef,\n      orderBy(\"title\"),\n      startAfter(lastVisible),\n      limit(4)\n    );\n    const nextBlogsSnaphot = await getDocs(nextBlogsQuery);\n    setBlogs(\n      nextBlogsSnaphot.docs.map((doc) => ({ id: doc.id, ...doc.data() }))\n    );\n    setCount(nextBlogsSnaphot.size);\n    setLastVisible(nextBlogsSnaphot.docs[nextBlogsSnaphot.docs.length - 1]);\n    setLoading(false);\n  };\n  const fetchPrev = async () => {\n    setLoading(true);\n    const blogRef = collection(db, \"blogs\");\n    const end =\n      noOfPages !== currentPage ? endAt(lastVisible) : endBefore(lastVisible);\n    const limitData =\n      noOfPages !== currentPage\n        ? limit(4)\n        : count <= 4 && noOfPages % 2 === 0\n        ? limit(4)\n        : limitToLast(4);\n    const prevBlogsQuery = query(blogRef, orderBy(\"title\"), end, limitData);\n    const prevBlogsSnaphot = await getDocs(prevBlogsQuery);\n    setBlogs(\n      prevBlogsSnaphot.docs.map((doc) => ({ id: doc.id, ...doc.data() }))\n    );\n    setCount(prevBlogsSnaphot.size);\n    setLastVisible(prevBlogsSnaphot.docs[prevBlogsSnaphot.docs.length - 1]);\n    setLoading(false);\n  };\n\n  const handlePageChange = (value) => {\n    if (value === \"Next\") {\n      setCurrentPage((page) => page + 1);\n      fetchMore();\n    } else if (value === \"Prev\") {\n      setCurrentPage((page) => page - 1);\n      fetchPrev();\n    }\n  };\n  return (\n    <div>\n      <div className=\"container\">\n        <div className=\"row\">\n          <div className=\"blog-heading text-center py-2 mb-4\">Daily Blogs</div>\n          {blogs?.map((blog) => (\n            <div className=\"col-md-6\" key={blog.id}>\n              <BlogSection {...blog} />\n            </div>\n          ))}\n        </div>\n        <Pagination\n          currentPage={currentPage}\n          noOfPages={noOfPages}\n          handlePageChange={handlePageChange}\n        />\n      </div>\n    </div>\n  );\n};\n\nexport default Blogs;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}