{"ast":null,"code":"import _toConsumableArray from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _objectSpread from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/abhishekkumar/Desktop/firebase-blog-master/node_modules/@babel/runtime/regenerator/index.js\";import{collection,doc,getDoc,getDocs,limit,query,serverTimestamp,Timestamp,updateDoc,orderBy,where}from\"firebase/firestore\";import{isEmpty}from\"lodash\";import React,{useState,useEffect}from\"react\";import{useParams}from\"react-router-dom\";import{toast}from\"react-toastify\";import CommentBox from\"../components/CommentBox\";import Like from\"../components/Like\";import FeatureBlogs from\"../components/FeatureBlogs\";import RelatedBlog from\"../components/RelatedBlog\";import Tags from\"../components/Tags\";import UserComments from\"../components/UserComments\";import{db}from\"../firebase\";import Spinner from\"../components/Spinner\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var Detail=function Detail(_ref){var setActive=_ref.setActive,user=_ref.user;var userId=user===null||user===void 0?void 0:user.uid;var _useParams=useParams(),id=_useParams.id;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),blog=_useState4[0],setBlog=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),blogs=_useState6[0],setBlogs=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),tags=_useState8[0],setTags=_useState8[1];var _useState9=useState([]),_useState10=_slicedToArray(_useState9,2),comments=_useState10[0],setComments=_useState10[1];var _useState11=useState([]),_useState12=_slicedToArray(_useState11,2),likes=_useState12[0],setLikes=_useState12[1];var _useState13=useState(\"\"),_useState14=_slicedToArray(_useState13,2),userComment=_useState14[0],setUserComment=_useState14[1];var _useState15=useState([]),_useState16=_slicedToArray(_useState15,2),relatedBlogs=_useState16[0],setRelatedBlogs=_useState16[1];useEffect(function(){var getRecentBlogs=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var blogRef,recentBlogs,docSnapshot;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:blogRef=collection(db,\"blogs\");recentBlogs=query(blogRef,orderBy(\"timestamp\",\"desc\"),limit(5));_context.next=4;return getDocs(recentBlogs);case 4:docSnapshot=_context.sent;setBlogs(docSnapshot.docs.map(function(doc){return _objectSpread({id:doc.id},doc.data());}));case 6:case\"end\":return _context.stop();}}},_callee);}));return function getRecentBlogs(){return _ref2.apply(this,arguments);};}();getRecentBlogs();},[]);useEffect(function(){id&&getBlogDetail();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[id]);// if (loading) {\n//   return <Spinner />;\n// }\nvar getBlogDetail=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var blogRef,docRef,blogDetail,blogs,tags,uniqueTags,relatedBlogsQuery,relatedBlogSnapshot,relatedBlogs;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:setLoading(true);blogRef=collection(db,\"blogs\");docRef=doc(db,\"blogs\",id);_context2.next=5;return getDoc(docRef);case 5:blogDetail=_context2.sent;_context2.next=8;return getDocs(blogRef);case 8:blogs=_context2.sent;tags=[];blogs.docs.map(function(doc){return tags.push.apply(tags,_toConsumableArray(doc.get(\"tags\")));});uniqueTags=_toConsumableArray(new Set(tags));setTags(uniqueTags);setBlog(blogDetail.data());relatedBlogsQuery=query(blogRef,where(\"tags\",\"array-contains-any\",blogDetail.data().tags,limit(3)));setComments(blogDetail.data().comments?blogDetail.data().comments:[]);setLikes(blogDetail.data().likes?blogDetail.data().likes:[]);_context2.next=19;return getDocs(relatedBlogsQuery);case 19:relatedBlogSnapshot=_context2.sent;relatedBlogs=[];relatedBlogSnapshot.forEach(function(doc){relatedBlogs.push(_objectSpread({id:doc.id},doc.data()));});setRelatedBlogs(relatedBlogs);setActive(null);setLoading(false);case 25:case\"end\":return _context2.stop();}}},_callee2);}));return function getBlogDetail(){return _ref3.apply(this,arguments);};}();var handleComment=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(e){return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:e.preventDefault();comments.push({createdAt:Timestamp.fromDate(new Date()),userId:userId,name:user===null||user===void 0?void 0:user.displayName,body:userComment});toast.success(\"Comment posted successfully\");_context3.next=5;return updateDoc(doc(db,\"blogs\",id),_objectSpread(_objectSpread({},blog),{},{comments:comments,timestamp:serverTimestamp()}));case 5:setComments(comments);setUserComment(\"\");case 7:case\"end\":return _context3.stop();}}},_callee3);}));return function handleComment(_x){return _ref4.apply(this,arguments);};}();var handleLike=/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){var index;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:if(!userId){_context4.next=4;break;}if(blog!==null&&blog!==void 0&&blog.likes){index=likes.findIndex(function(id){return id===userId;});if(index===-1){likes.push(userId);setLikes(_toConsumableArray(new Set(likes)));}else{likes=likes.filter(function(id){return id!==userId;});setLikes(likes);}}_context4.next=4;return updateDoc(doc(db,\"blogs\",id),_objectSpread(_objectSpread({},blog),{},{likes:likes,timestamp:serverTimestamp()}));case 4:case\"end\":return _context4.stop();}}},_callee4);}));return function handleLike(){return _ref5.apply(this,arguments);};}();console.log(\"relatedBlogs\",relatedBlogs);return/*#__PURE__*/_jsxs(\"div\",{className:\"single\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"blog-title-box\",style:{backgroundImage:\"url('\".concat(blog===null||blog===void 0?void 0:blog.imgUrl,\"')\")},children:[/*#__PURE__*/_jsx(\"div\",{className:\"overlay\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"blog-title\",children:[/*#__PURE__*/_jsx(\"span\",{children:blog===null||blog===void 0?void 0:blog.timestamp.toDate().toDateString()}),/*#__PURE__*/_jsx(\"h2\",{children:blog===null||blog===void 0?void 0:blog.title})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"container-fluid pb-4 pt-4 padding blog-single-content\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"container padding\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"row mx-0\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-8\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"meta-info text-start\",children:[\"By \",/*#__PURE__*/_jsx(\"p\",{className:\"author\",children:blog===null||blog===void 0?void 0:blog.author}),\" -\\xA0\",blog===null||blog===void 0?void 0:blog.timestamp.toDate().toDateString(),/*#__PURE__*/_jsx(Like,{handleLike:handleLike,likes:likes,userId:userId})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-start\",children:blog===null||blog===void 0?void 0:blog.description}),/*#__PURE__*/_jsx(\"div\",{className:\"text-start\",children:/*#__PURE__*/_jsx(Tags,{tags:blog===null||blog===void 0?void 0:blog.tags})}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsx(\"div\",{className:\"custombox\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"scroll\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"small-title\",children:[comments===null||comments===void 0?void 0:comments.length,\" Comment\"]}),isEmpty(comments)?/*#__PURE__*/_jsx(UserComments,{msg:\"No Comment yet posted on this blog. Be the first to comment\"}):/*#__PURE__*/_jsx(_Fragment,{children:comments===null||comments===void 0?void 0:comments.map(function(comment){return/*#__PURE__*/_jsx(UserComments,_objectSpread({},comment));})})]})}),/*#__PURE__*/_jsx(CommentBox,{userId:userId,userComment:userComment,setUserComment:setUserComment,handleComment:handleComment})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"col-md-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"blog-heading text-start py-2 mb-4\",children:\"Tags\"}),/*#__PURE__*/_jsx(Tags,{tags:tags}),/*#__PURE__*/_jsx(FeatureBlogs,{title:\"Recent Blogs\",blogs:blogs})]})]}),/*#__PURE__*/_jsx(RelatedBlog,{id:id,blogs:relatedBlogs})]})})]});};export default Detail;","map":null,"metadata":{},"sourceType":"module"}